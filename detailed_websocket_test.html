<!DOCTYPE html>
<html>
<head>
    <title>Detailed WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <h1>Detailed WebSocket Test</h1>
    <div id="logs"></div>
    
    <script>
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTgzODIwNzEsInN1YiI6IjUzNjRlNjhhLTcyYWUtNDVmNy1iNjNiLTBhY2Q1MjRmZjE2OCJ9.JPkiLqCrqxqDTxhq4dX7gDCZtFdbEuJv23WyuI_U_kc';
        const roomId = 1;
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            document.getElementById('logs').appendChild(div);
            console.log(message);
        }
        
        function testWebSocket() {
            const wsUrl = `ws://medic.yoon.today/api/chat/ws/${roomId}?token=${token}`;
            addLog('Starting WebSocket test...', 'info');
            addLog('URL: ' + wsUrl, 'info');
            
            // ë¸Œë¼ìš°ì € ì •ë³´
            addLog('User Agent: ' + navigator.userAgent, 'info');
            addLog('WebSocket Support: ' + (typeof WebSocket !== 'undefined'), 'info');
            
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = function(event) {
                addLog('âœ… WebSocket ì—°ê²° ì„±ê³µ!', 'success');
                addLog('Ready State: ' + ws.readyState, 'success');
                addLog('Protocol: ' + ws.protocol, 'success');
            };
            
            ws.onmessage = function(event) {
                addLog('ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + event.data, 'success');
            };
            
            ws.onclose = function(event) {
                addLog('âŒ WebSocket ì—°ê²° ì¢…ë£Œ', 'error');
                addLog('Close Code: ' + event.code, 'error');
                addLog('Close Reason: ' + event.reason, 'error');
                addLog('Was Clean: ' + event.wasClean, 'error');
                
                // ì˜¤ë¥˜ ì½”ë“œë³„ ì„¤ëª…
                const codeDescriptions = {
                    1000: 'ì •ìƒ ì¢…ë£Œ',
                    1001: 'ì—”ë“œí¬ì¸íŠ¸ê°€ ì‚¬ë¼ì§',
                    1002: 'í”„ë¡œí† ì½œ ì˜¤ë¥˜',
                    1003: 'ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„° íƒ€ì…',
                    1006: 'ë¹„ì •ìƒì ì¸ ì—°ê²° ì¢…ë£Œ (ì„œë²„ ì‘ë‹µ ì—†ìŒ)',
                    1007: 'ì˜ëª»ëœ í”„ë ˆì„ ë°ì´í„°',
                    1008: 'ì •ì±… ìœ„ë°˜',
                    1009: 'ë©”ì‹œì§€ê°€ ë„ˆë¬´ í¼',
                    1010: 'í™•ì¥ í˜‘ìƒ ì‹¤íŒ¨',
                    1011: 'ì„œë²„ ì˜¤ë¥˜'
                };
                
                if (codeDescriptions[event.code]) {
                    addLog('ì˜¤ë¥˜ ì„¤ëª…: ' + codeDescriptions[event.code], 'error');
                }
            };
            
            ws.onerror = function(error) {
                addLog('âŒ WebSocket ì˜¤ë¥˜ ë°œìƒ', 'error');
                addLog('Error: ' + JSON.stringify(error), 'error');
                addLog('Ready State: ' + ws.readyState, 'error');
            };
            
            // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
            setTimeout(() => {
                addLog('ì—°ê²° ìƒíƒœ ì²´í¬ (5ì´ˆ í›„): ' + ws.readyState, 'info');
                if (ws.readyState === WebSocket.CONNECTING) {
                    addLog('âš ï¸ ì•„ì§ ì—°ê²° ì¤‘...', 'error');
                } else if (ws.readyState === WebSocket.OPEN) {
                    addLog('âœ… ì—°ê²° ì„±ê³µ!', 'success');
                } else {
                    addLog('âŒ ì—°ê²° ì‹¤íŒ¨ ë˜ëŠ” ì¢…ë£Œë¨', 'error');
                }
            }, 5000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            addLog('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');
            addLog('WebSocket í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            testWebSocket();
        };
    </script>
</body>
</html>
